<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Engine Usage Summary</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --claude-color: #00ff94;
            --groq-color: #ff6b35;
            --bg-dark: #0a0a0a;
            --card-bg: #12121a;
            --border-color: #1e1e2e;
            --text-primary: #e0e0e0;
            --text-secondary: #757575;
        }

        body {
            font-family: 'SF Mono', monospace;
            background: var(--bg-dark);
            color: var(--text-primary);
            margin: 0;
            padding: 20px;
        }

        .summary-container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .panel {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
        }

        .panel h2 {
            margin: 0 0 16px 0;
            color: var(--claude-color);
            font-size: 18px;
            font-weight: 600;
        }

        .metric-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 20px;
        }

        .metric {
            text-align: center;
            padding: 16px;
            background: var(--bg-dark);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .metric-value {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .metric-value.claude {
            color: var(--claude-color);
        }

        .metric-value.groq {
            color: var(--groq-color);
        }

        .metric-value.neutral {
            color: #ffb800;
        }

        .metric-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 20px;
        }

        .model-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .model-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .model-name {
            font-family: 'SF Mono', monospace;
            font-size: 13px;
        }

        .model-usage {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .usage-bar {
            width: 60px;
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
        }

        .usage-fill {
            height: 100%;
            transition: width 0.5s ease;
        }

        .usage-fill.claude {
            background: var(--claude-color);
        }

        .usage-fill.groq {
            background: var(--groq-color);
        }

        .usage-percentage {
            font-size: 11px;
            color: var(--text-secondary);
            min-width: 35px;
            text-align: right;
        }

        .trend-indicator {
            display: inline-block;
            font-size: 14px;
            margin-left: 8px;
        }

        .trend-up {
            color: var(--claude-color);
        }

        .trend-down {
            color: var(--groq-color);
        }

        .efficiency-score {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 120px;
            background: radial-gradient(circle, rgba(0, 255, 148, 0.1), transparent);
            border-radius: 50%;
            margin: 20px auto;
            width: 120px;
            position: relative;
        }

        .efficiency-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--claude-color);
        }

        .efficiency-label {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        .timeline {
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
        }

        .timeline-event {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            font-size: 11px;
            line-height: 1.4;
        }

        .timeline-time {
            color: var(--text-secondary);
            min-width: 60px;
        }

        .timeline-event-type {
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 9px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .event-selection {
            background: rgba(0, 255, 148, 0.2);
            color: var(--claude-color);
        }

        .event-switch {
            background: rgba(255, 107, 53, 0.2);
            color: var(--groq-color);
        }

        .cost-breakdown {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .cost-item {
            padding: 12px;
            background: var(--bg-dark);
            border-radius: 8px;
            border-left: 4px solid;
        }

        .cost-item.claude {
            border-left-color: var(--claude-color);
        }

        .cost-item.groq {
            border-left-color: var(--groq-color);
        }

        .cost-amount {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .cost-description {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .full-width {
            grid-column: 1 / -1;
        }
    </style>
</head>
<body>
    <div class="summary-container">
        <!-- Overview Metrics -->
        <div class="panel full-width">
            <h2>Engine Usage Overview</h2>
            <div class="metric-grid">
                <div class="metric">
                    <div class="metric-value claude" id="total-requests">0</div>
                    <div class="metric-label">Total Requests</div>
                </div>
                <div class="metric">
                    <div class="metric-value neutral" id="total-cost">$0.00</div>
                    <div class="metric-label">Total Cost</div>
                </div>
                <div class="metric">
                    <div class="metric-value groq" id="total-switches">0</div>
                    <div class="metric-label">Engine Switches</div>
                </div>
            </div>
        </div>

        <!-- Distribution Chart -->
        <div class="panel">
            <h2>Usage Distribution</h2>
            <div class="chart-container">
                <canvas id="distributionChart"></canvas>
            </div>
            <div class="cost-breakdown">
                <div class="cost-item claude">
                    <div class="cost-amount" id="claude-cost">$0.00</div>
                    <div class="cost-description">Claude Cost</div>
                </div>
                <div class="cost-item groq">
                    <div class="cost-amount" id="groq-cost">$0.00</div>
                    <div class="cost-description">Groq Cost</div>
                </div>
            </div>
        </div>

        <!-- Model Usage -->
        <div class="panel">
            <h2>Model Usage</h2>
            <div class="model-list" id="model-list">
                <!-- Model usage items will be populated here -->
            </div>
            <div class="efficiency-score">
                <span class="efficiency-value" id="efficiency-score">85</span>
                <span class="efficiency-label">Efficiency Score</span>
            </div>
        </div>

        <!-- Cost Timeline -->
        <div class="panel">
            <h2>Cost Over Time</h2>
            <div class="chart-container">
                <canvas id="costChart"></canvas>
            </div>
        </div>

        <!-- Recent Events -->
        <div class="panel">
            <h2>Recent Engine Events</h2>
            <div class="timeline" id="events-timeline">
                <!-- Timeline events will be populated here -->
            </div>
        </div>
    </div>

    <script>
        // Initialize charts
        const distributionCtx = document.getElementById('distributionChart').getContext('2d');
        const costCtx = document.getElementById('costChart').getContext('2d');

        const distributionChart = new Chart(distributionCtx, {
            type: 'doughnut',
            data: {
                labels: ['Claude', 'Groq'],
                datasets: [{
                    data: [60, 40],
                    backgroundColor: ['#00ff94', '#ff6b35'],
                    borderWidth: 2,
                    borderColor: '#12121a'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            color: '#e0e0e0',
                            font: {
                                family: 'SF Mono',
                                size: 12
                            }
                        }
                    }
                }
            }
        });

        const costChart = new Chart(costCtx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [
                    {
                        label: 'Claude',
                        data: [],
                        borderColor: '#00ff94',
                        backgroundColor: 'rgba(0, 255, 148, 0.1)',
                        tension: 0.1
                    },
                    {
                        label: 'Groq',
                        data: [],
                        borderColor: '#ff6b35',
                        backgroundColor: 'rgba(255, 107, 53, 0.1)',
                        tension: 0.1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            color: '#757575',
                            font: {
                                family: 'SF Mono',
                                size: 10
                            },
                            callback: function(value) {
                                return '$' + value.toFixed(2);
                            }
                        },
                        grid: {
                            color: '#1e1e2e'
                        }
                    },
                    x: {
                        ticks: {
                            color: '#757575',
                            font: {
                                family: 'SF Mono',
                                size: 10
                            }
                        },
                        grid: {
                            color: '#1e1e2e'
                        }
                    }
                },
                plugins: {
                    legend: {
                        labels: {
                            color: '#e0e0e0',
                            font: {
                                family: 'SF Mono',
                                size: 12
                            }
                        }
                    }
                }
            }
        });

        // Sample data
        const sampleData = {
            totalRequests: 1247,
            totalCost: 12.34,
            totalSwitches: 23,
            claudeCost: 8.90,
            groqCost: 3.44,
            claudePercentage: 65,
            groqPercentage: 35,
            models: [
                { name: 'claude-sonnet-4', engine: 'claude', usage: 45 },
                { name: 'claude-haiku-4', engine: 'claude', usage: 20 },
                { name: 'llama-3.3-70b', engine: 'groq', usage: 25 },
                { name: 'llama-3.1-8b', engine: 'groq', usage: 10 }
            ],
            events: [
                { time: '14:32', type: 'selection', description: 'Worker 1: Claude selected for complex analysis' },
                { time: '14:31', type: 'switch', description: 'Worker 3: Groq → Claude (complexity increased)' },
                { time: '14:30', type: 'selection', description: 'Worker 2: Groq selected for simple task' },
                { time: '14:29', type: 'switch', description: 'Worker 1: Claude → Groq (speed optimization)' },
                { time: '14:28', type: 'selection', description: 'Worker 4: Claude selected for security review' }
            ]
        };

        function updateMetrics() {
            document.getElementById('total-requests').textContent = sampleData.totalRequests.toLocaleString();
            document.getElementById('total-cost').textContent = '$' + sampleData.totalCost.toFixed(2);
            document.getElementById('total-switches').textContent = sampleData.totalSwitches;
            document.getElementById('claude-cost').textContent = '$' + sampleData.claudeCost.toFixed(2);
            document.getElementById('groq-cost').textContent = '$' + sampleData.groqCost.toFixed(2);

            // Update efficiency score (cost savings ratio)
            const efficiencyScore = Math.round(((sampleData.groqCost / sampleData.totalCost) * 100));
            document.getElementById('efficiency-score').textContent = efficiencyScore;

            // Update chart data
            distributionChart.data.datasets[0].data = [sampleData.claudePercentage, sampleData.groqPercentage];
            distributionChart.update();
        }

        function updateModelList() {
            const modelList = document.getElementById('model-list');
            modelList.innerHTML = sampleData.models.map(model => `
                <div class="model-item">
                    <div class="model-name">${model.name}</div>
                    <div class="model-usage">
                        <div class="usage-bar">
                            <div class="usage-fill ${model.engine}" style="width: ${model.usage}%"></div>
                        </div>
                        <div class="usage-percentage">${model.usage}%</div>
                    </div>
                </div>
            `).join('');
        }

        function updateTimeline() {
            const timeline = document.getElementById('events-timeline');
            timeline.innerHTML = sampleData.events.map(event => `
                <div class="timeline-event">
                    <div class="timeline-time">${event.time}</div>
                    <div class="timeline-event-type event-${event.type}">${event.type}</div>
                    <div>${event.description}</div>
                </div>
            `).join('');
        }

        function updateCostChart() {
            // Generate sample cost timeline data
            const times = [];
            const claudeData = [];
            const groqData = [];

            for (let i = 0; i < 10; i++) {
                times.push((new Date(Date.now() - (10 - i) * 60000)).toLocaleTimeString());
                claudeData.push((sampleData.claudeCost * (i + 1)) / 10);
                groqData.push((sampleData.groqCost * (i + 1)) / 10);
            }

            costChart.data.labels = times;
            costChart.data.datasets[0].data = claudeData;
            costChart.data.datasets[1].data = groqData;
            costChart.update();
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            updateMetrics();
            updateModelList();
            updateTimeline();
            updateCostChart();

            // Auto-refresh every 30 seconds
            setInterval(() => {
                // In a real implementation, fetch fresh data from API
                updateMetrics();
                updateModelList();
                updateTimeline();
                updateCostChart();
            }, 30000);
        });

        // Add real-time data fetching
        async function fetchEngineData() {
            try {
                const response = await fetch('/api/engine/summary');
                const data = await response.json();

                // Update with real data
                if (data) {
                    // Update sample data with real values
                    Object.assign(sampleData, data);
                    updateMetrics();
                    updateModelList();
                    updateTimeline();
                    updateCostChart();
                }
            } catch (error) {
                console.log('Using sample data - API not available');
            }
        }

        // Fetch real data on load and periodically
        document.addEventListener('DOMContentLoaded', fetchEngineData);
        setInterval(fetchEngineData, 10000);
    </script>
</body>
</html>