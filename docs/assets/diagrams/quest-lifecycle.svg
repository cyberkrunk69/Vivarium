<svg xmlns="http://www.w3.org/2000/svg" width="1520" height="760" viewBox="0 0 1520 760" role="img" aria-labelledby="title desc">
  <title id="title">Quest Lifecycle from Mailbox to Completion</title>
  <desc id="desc">Static flow diagram of mailbox quest assignment, worker execution, polling, operator controls, and completion approval reward.</desc>
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#475569"/>
    </marker>
    <style>
      .title { font: 700 30px Inter,Segoe UI,Arial,sans-serif; fill: #0f172a; }
      .subtitle { font: 500 15px Inter,Segoe UI,Arial,sans-serif; fill: #475569; }
      .lane-label { font: 700 16px Inter,Segoe UI,Arial,sans-serif; fill: #1e293b; }
      .lane { fill: #f8fafc; stroke: #cbd5e1; stroke-width: 2; rx: 12; }
      .step-ui { fill: #e0f2fe; stroke: #0284c7; stroke-width: 2; rx: 10; }
      .step-runtime { fill: #dcfce7; stroke: #16a34a; stroke-width: 2; rx: 10; }
      .step-human { fill: #fef3c7; stroke: #d97706; stroke-width: 2; rx: 10; }
      .step-log { fill: #ede9fe; stroke: #7c3aed; stroke-width: 2; rx: 10; }
      .num { fill: #0f172a; font: 700 13px Inter,Segoe UI,Arial,sans-serif; }
      .text { fill: #0f172a; font: 600 13px Inter,Segoe UI,Arial,sans-serif; }
      .small { fill: #334155; font: 500 12px Inter,Segoe UI,Arial,sans-serif; }
      .edge { stroke: #475569; stroke-width: 2; fill: none; marker-end: url(#arrow); }
      .edge-dash { stroke: #64748b; stroke-width: 2; fill: none; stroke-dasharray: 7 6; marker-end: url(#arrow); }
      .loop { stroke: #0ea5e9; stroke-width: 2; fill: none; stroke-dasharray: 8 6; marker-end: url(#arrow); }
    </style>
  </defs>

  <rect x="0" y="0" width="1520" height="760" fill="#ffffff"/>
  <text x="40" y="56" class="title">Mailbox Quest Lifecycle (Static SVG)</text>
  <text x="40" y="82" class="subtitle">Shows assignment, queue execution, realtime monitoring, operator controls, and approval/reward completion.</text>

  <!-- Lanes -->
  <rect x="40" y="110" width="1440" height="172" class="lane"/>
  <text x="60" y="140" class="lane-label">Human + UI Orchestration</text>

  <rect x="40" y="300" width="1440" height="172" class="lane"/>
  <text x="60" y="330" class="lane-label">Worker + API Runtime</text>

  <rect x="40" y="490" width="1440" height="210" class="lane"/>
  <text x="60" y="520" class="lane-label">Logs + State Effects</text>

  <!-- Human/UI lane -->
  <rect x="84" y="164" width="246" height="86" class="step-human"/>
  <circle cx="108" cy="187" r="14" fill="#fde68a"/><text x="103" y="191" class="num">1</text>
  <text x="130" y="188" class="text">Human assigns quest</text>
  <text x="130" y="208" class="small">identity, objective, budget, tip</text>
  <text x="130" y="226" class="small">reward terms set in mailbox</text>

  <rect x="356" y="164" width="250" height="86" class="step-ui"/>
  <circle cx="380" cy="187" r="14" fill="#bae6fd"/><text x="375" y="191" class="num">2</text>
  <text x="402" y="188" class="text">UI writes initial state</text>
  <text x="402" y="208" class="small">mailbox_quests + queue task</text>
  <text x="402" y="226" class="small">upfront tip token grant</text>

  <rect x="632" y="164" width="250" height="86" class="step-ui"/>
  <circle cx="656" cy="187" r="14" fill="#bae6fd"/><text x="651" y="191" class="num">6</text>
  <text x="678" y="188" class="text">UI polls progress loop</text>
  <text x="678" y="208" class="small">reads execution events</text>
  <text x="678" y="226" class="small">renders live quest status</text>

  <rect x="908" y="164" width="250" height="86" class="step-human"/>
  <circle cx="932" cy="187" r="14" fill="#fde68a"/><text x="927" y="191" class="num">7</text>
  <text x="954" y="188" class="text">Operator controls</text>
  <text x="954" y="208" class="small">tip / pause / resume</text>
  <text x="954" y="226" class="small">through mailbox controls</text>

  <rect x="1184" y="164" width="250" height="86" class="step-human"/>
  <circle cx="1208" cy="187" r="14" fill="#fde68a"/><text x="1201" y="191" class="num">9</text>
  <text x="1230" y="188" class="text">Human final approval</text>
  <text x="1230" y="208" class="small">quest completion approved</text>
  <text x="1230" y="226" class="small">completion reward unlocked</text>

  <!-- Runtime lane -->
  <rect x="244" y="354" width="250" height="86" class="step-runtime"/>
  <circle cx="268" cy="377" r="14" fill="#bbf7d0"/><text x="263" y="381" class="num">3</text>
  <text x="290" y="378" class="text">Worker polls queue</text>
  <text x="290" y="398" class="small">acquire task lock</text>
  <text x="290" y="416" class="small">begin execution</text>

  <rect x="520" y="354" width="250" height="86" class="step-runtime"/>
  <circle cx="544" cy="377" r="14" fill="#bbf7d0"/><text x="539" y="381" class="num">4</text>
  <text x="566" y="378" class="text">Worker calls /cycle API</text>
  <text x="566" y="398" class="small">task cycle executes</text>
  <text x="566" y="416" class="small">returns status + usage</text>

  <rect x="796" y="354" width="250" height="86" class="step-runtime"/>
  <circle cx="820" cy="377" r="14" fill="#bbf7d0"/><text x="815" y="381" class="num">8</text>
  <text x="842" y="378" class="text">Terminal execution event</text>
  <text x="842" y="398" class="small">completed / approved</text>
  <text x="842" y="416" class="small">or requeue / failed</text>

  <!-- Logs + state lane -->
  <rect x="520" y="548" width="250" height="90" class="step-log"/>
  <circle cx="544" cy="572" r="14" fill="#ddd6fe"/><text x="539" y="576" class="num">5</text>
  <text x="568" y="574" class="text">execution_log append</text>
  <text x="568" y="594" class="small">lifecycle snapshots</text>
  <text x="568" y="612" class="small">used for progress UI</text>

  <rect x="908" y="548" width="250" height="90" class="step-log"/>
  <circle cx="932" cy="572" r="14" fill="#ddd6fe"/><text x="925" y="576" class="num">10</text>
  <text x="954" y="574" class="text">Finalize quest record</text>
  <text x="954" y="594" class="small">mark completed</text>
  <text x="954" y="612" class="small">pay guaranteed reward</text>

  <!-- Main flow edges -->
  <path d="M330 207 L356 207" class="edge"/>
  <path d="M606 207 L632 207" class="edge"/>
  <path d="M882 207 L908 207" class="edge"/>
  <path d="M1158 207 L1184 207" class="edge"/>

  <path d="M481 250 C481 310, 330 310, 330 354" class="edge"/>
  <path d="M494 397 L520 397" class="edge"/>
  <path d="M770 397 L796 397" class="edge"/>
  <path d="M645 440 L645 548" class="edge"/>
  <path d="M921 440 C921 500, 1033 500, 1033 548" class="edge"/>
  <path d="M1309 250 C1309 498, 1033 498, 1033 548" class="edge"/>

  <!-- Control side-effects -->
  <path d="M1033 250 C1033 318, 921 318, 921 354" class="edge-dash"/>
  <path d="M1006 250 C1006 470, 645 470, 645 548" class="edge-dash"/>

  <!-- Poll loop -->
  <path d="M657 164 C580 122, 520 122, 520 207 C520 282, 620 282, 657 250" class="loop"/>
  <text x="538" y="128" class="small">polling loop while active</text>

  <!-- Legend -->
  <rect x="84" y="548" width="406" height="90" class="lane"/>
  <rect x="102" y="568" width="78" height="24" class="step-human"/><text x="122" y="585" class="small">Human</text>
  <rect x="192" y="568" width="78" height="24" class="step-ui"/><text x="221" y="585" class="small">UI</text>
  <rect x="282" y="568" width="78" height="24" class="step-runtime"/><text x="300" y="585" class="small">Runtime</text>
  <rect x="372" y="568" width="100" height="24" class="step-log"/><text x="397" y="585" class="small">Logs/State</text>
  <line x1="110" y1="616" x2="190" y2="616" class="edge"/><text x="200" y="621" class="small">solid: canonical flow</text>
  <line x1="306" y1="616" x2="386" y2="616" class="edge-dash"/><text x="396" y="621" class="small">dashed: side effects/control</text>
</svg>
