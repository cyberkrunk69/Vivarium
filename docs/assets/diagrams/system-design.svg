<svg xmlns="http://www.w3.org/2000/svg" width="1400" height="880" viewBox="0 0 1400 880" role="img" aria-labelledby="title desc">
  <title id="title">Vivarium MVP Runtime Architecture</title>
  <desc id="desc">Launcher, runtime processes, mutable state, audit trail, and mailbox/context orchestration.</desc>
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#475569"/>
    </marker>
    <style>
      .title { font: 700 26px Inter,Segoe UI,Arial,sans-serif; fill: #0f172a; }
      .subtitle { font: 500 13px Inter,Segoe UI,Arial,sans-serif; fill: #475569; }
      .group { fill: #f8fafc; stroke: #cbd5e1; stroke-width: 2; rx: 14; }
      .group-label { font: 700 16px Inter,Segoe UI,Arial,sans-serif; fill: #1e293b; }
      .proc { fill: #e0f2fe; stroke: #0284c7; stroke-width: 2; rx: 10; }
      .data { fill: #dcfce7; stroke: #16a34a; stroke-width: 2; rx: 10; }
      .note { fill: #ede9fe; stroke: #7c3aed; stroke-width: 2; rx: 10; }
      .warn { fill: #fef3c7; stroke: #d97706; stroke-width: 2; rx: 10; }
      .ntext { font: 600 12px Inter,Segoe UI,Arial,sans-serif; fill: #0f172a; }
      .small { font: 500 11px Inter,Segoe UI,Arial,sans-serif; fill: #334155; }
      .edge { stroke: #475569; stroke-width: 2; fill: none; marker-end: url(#arrow); }
      .edge-dashed { stroke: #64748b; stroke-width: 2; fill: none; stroke-dasharray: 6 5; marker-end: url(#arrow); }
      .legend { font: 600 11px Inter,Segoe UI,Arial,sans-serif; fill: #334155; }
    </style>
  </defs>

  <rect x="0" y="0" width="1400" height="880" fill="#ffffff"/>
  <text x="40" y="48" class="title">Vivarium MVP Runtime Architecture</text>
  <text x="40" y="72" class="subtitle">Launcher → runtime processes → mutable state. Worker polls queue, calls /cycle; control panel manages mailbox and tails logs.</text>

  <!-- Launch + Operator -->
  <rect x="40" y="100" width="320" height="260" class="group"/>
  <text x="58" y="128" class="group-label">Launch + Operator</text>

  <rect x="68" y="162" width="120" height="52" class="warn"/>
  <text x="95" y="192" class="ntext">Human</text>

  <rect x="208" y="152" width="132" height="52" class="proc"/>
  <text x="228" y="177" class="ntext">Launcher scripts</text>
  <text x="220" y="192" class="small">mac / ps1 / bat</text>

  <rect x="208" y="222" width="132" height="52" class="proc"/>
  <text x="228" y="247" class="ntext">dev_launcher.py</text>

  <rect x="208" y="292" width="132" height="52" class="data"/>
  <text x="238" y="322" class="ntext">Install cache</text>

  <path d="M188 188 L208 178" class="edge"/>
  <path d="M274 204 L274 222" class="edge"/>
  <path d="M274 274 L274 292" class="edge"/>

  <!-- Runtime -->
  <rect x="400" y="100" width="340" height="260" class="group"/>
  <text x="418" y="128" class="group-label">Runtime Processes</text>

  <rect x="428" y="162" width="140" height="52" class="proc"/>
  <text x="450" y="187" class="ntext">Control panel UI</text>
  <text x="444" y="202" class="small">control_panel_app.py</text>

  <rect x="588" y="162" width="132" height="52" class="proc"/>
  <text x="618" y="187" class="ntext">Cycle API</text>
  <text x="612" y="202" class="small">swarm_api.py /cycle</text>

  <rect x="498" y="232" width="132" height="52" class="proc"/>
  <text x="518" y="257" class="ntext">Worker runtime</text>
  <text x="508" y="272" class="small">queue executor loop</text>

  <rect x="498" y="302" width="132" height="42" class="data"/>
  <text x="534" y="328" class="ntext">queue.json</text>

  <!-- dev_launcher launches Control Panel + Cycle API -->
  <path d="M340 248 L428 188" class="edge"/>
  <path d="M340 248 L588 188" class="edge"/>
  <!-- Human uses Control Panel -->
  <path d="M188 188 L428 188" class="edge-dashed"/>
  <!-- Worker polls queue, dispatch task to Cycle API -->
  <path d="M564 232 L564 302" class="edge"/>
  <path d="M564 302 L564 232" class="edge-dashed"/>
  <path d="M564 257 L654 214" class="edge"/>

  <!-- Mutable state -->
  <rect x="780" y="100" width="580" height="260" class="group"/>
  <text x="798" y="128" class="group-label">Mutable State</text>

  <rect x="808" y="162" width="160" height="48" class="data"/>
  <text x="848" y="190" class="ntext">identities/*.json</text>

  <rect x="988" y="162" width="160" height="48" class="data"/>
  <text x="1028" y="190" class="ntext">free_time_balances</text>

  <rect x="1168" y="162" width="168" height="48" class="data"/>
  <text x="1218" y="190" class="ntext">bounties.json</text>

  <rect x="808" y="228" width="160" height="48" class="data"/>
  <text x="848" y="256" class="ntext">discussions/*.jsonl</text>

  <rect x="988" y="228" width="160" height="48" class="data"/>
  <text x="1018" y="256" class="ntext">messages_to_human</text>

  <rect x="1168" y="228" width="168" height="48" class="data"/>
  <text x="1218" y="256" class="ntext">from_human / outbox</text>

  <rect x="988" y="294" width="160" height="48" class="data"/>
  <text x="1028" y="322" class="ntext">mailbox_quests</text>

  <!-- Worker writes/reads state -->
  <path d="M630 302 L808 186" class="edge"/>
  <path d="M630 302 L808 252" class="edge"/>
  <path d="M630 302 L988 252" class="edge"/>
  <path d="M630 302 L988 318" class="edge"/>

  <!-- Audit -->
  <rect x="40" y="396" width="660" height="200" class="group"/>
  <text x="58" y="426" class="group-label">Audit + Review Trail</text>

  <rect x="82" y="462" width="170" height="56" class="data"/>
  <text x="109" y="492" class="ntext">execution_log.jsonl</text>

  <rect x="272" y="462" width="170" height="56" class="data"/>
  <text x="312" y="492" class="ntext">action_log.jsonl</text>

  <rect x="462" y="456" width="216" height="68" class="note"/>
  <text x="508" y="484" class="ntext">Review lifecycle</text>
  <text x="494" y="502" class="small">pending_review → human approves</text>
  <text x="508" y="518" class="small">requeue / failed</text>

  <!-- Worker writes logs -->
  <path d="M564 284 L174 462" class="edge"/>
  <path d="M564 284 L378 462" class="edge"/>
  <path d="M252 490 L462 490" class="edge"/>
  <path d="M442 490 L462 490" class="edge"/>

  <!-- Control Panel tails logs (dashed) -->
  <path d="M428 214 L174 462" class="edge-dashed"/>
  <path d="M428 214 L378 462" class="edge-dashed"/>

  <!-- Mailbox + Context -->
  <rect x="740" y="396" width="620" height="388" class="group"/>
  <text x="758" y="426" class="group-label">Mailbox + Context Orchestration</text>

  <rect x="770" y="462" width="180" height="60" class="note"/>
  <text x="800" y="490" class="ntext">Thread inbox/outbox</text>
  <text x="800" y="508" class="small">human async channels</text>

  <rect x="970" y="462" width="180" height="60" class="note"/>
  <text x="1010" y="490" class="ntext">Quest manager</text>
  <text x="990" y="508" class="small">assign / status / control</text>

  <rect x="770" y="542" width="180" height="60" class="note"/>
  <text x="810" y="570" class="ntext">Tip/Pause/Resume</text>
  <text x="810" y="588" class="small">operator controls</text>

  <rect x="970" y="542" width="180" height="60" class="note"/>
  <text x="990" y="570" class="ntext">Realtime polling UI</text>
  <text x="990" y="588" class="small">live task visibility</text>

  <rect x="770" y="632" width="380" height="124" class="note"/>
  <text x="800" y="662" class="ntext">Deterministic context compaction</text>
  <text x="800" y="684" class="small">get_discussion_context() + get_enrichment_context()</text>
  <text x="800" y="702" class="small">checkSelf, checkMemory, checkMailbox, checkBounties, checkGuild, checkLibrary</text>
  <text x="800" y="738" class="small">Produces compact payload for /cycle</text>

  <!-- Control Panel manages mailbox -->
  <path d="M568 214 L770 492" class="edge"/>
  <path d="M568 214 L970 492" class="edge"/>
  <path d="M860 522 L860 542" class="edge"/>
  <path d="M1060 522 L1060 542" class="edge"/>
  <path d="M960 602 L960 632" class="edge"/>

  <!-- Context compaction: Worker builds, feeds Cycle API -->
  <path d="M630 284 L770 692" class="edge"/>
  <path d="M1150 692 L654 214" class="edge"/>

  <!-- Mailbox reads/writes state (dashed) -->
  <path d="M860 492 L988 318" class="edge-dashed"/>

  <!-- Legend -->
  <rect x="40" y="624" width="660" height="160" class="group"/>
  <text x="58" y="654" class="group-label">Legend</text>
  <rect x="86" y="684" width="140" height="36" class="proc"/>
  <text x="138" y="708" class="legend">Process</text>
  <rect x="244" y="684" width="140" height="36" class="data"/>
  <text x="304" y="708" class="legend">State file</text>
  <rect x="402" y="684" width="140" height="36" class="note"/>
  <text x="462" y="708" class="legend">Controller</text>
  <rect x="560" y="684" width="120" height="36" class="warn"/>
  <text x="605" y="708" class="legend">Actor</text>
  <line x1="86" y1="752" x2="206" y2="752" class="edge"/>
  <text x="216" y="757" class="legend">solid = write/call/control</text>
  <line x1="402" y1="752" x2="522" y2="752" class="edge-dashed"/>
  <text x="532" y="757" class="legend">dashed = read/observe</text>
</svg>
