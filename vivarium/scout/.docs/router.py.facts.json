{"ast_hash": "e2caea9802dd6fa9c3d360e2a96703f76824af4082ce412788e0fd80767b9218", "control_flow": {"TriggerRouter._list_python_files": [{"blocks": [{"condition": "not base.exists()", "line": 347, "type": "if"}], "function_name": "TriggerRouter._list_python_files"}], "TriggerRouter._load_symbol_docs": [{"blocks": [{"condition": "parts", "line": 761, "type": "if"}], "function_name": "TriggerRouter._load_symbol_docs"}], "TriggerRouter._parse_nav_json": [{"blocks": [{"condition": "content.startswith('```')", "line": 365, "type": "if"}], "function_name": "TriggerRouter._parse_nav_json"}], "TriggerRouter._process_file": [{"blocks": [{"condition": "not validation.is_valid", "line": 989, "type": "if"}, {"condition": "not validation.is_valid", "line": 1016, "type": "if"}, {"condition": "enable_commit", "line": 1043, "type": "if"}, {"condition": "enable_pr", "line": 1048, "type": "if"}, {"condition": "enable_impact", "line": 1053, "type": "if"}, {"condition": "draft_coros", "line": 1059, "type": "if"}, {"condition": "self._affects_module_boundary(file, nav_result)", "line": 1070, "type": "if"}], "function_name": "TriggerRouter._process_file"}], "TriggerRouter._update_module_brief": [{"blocks": [{"condition": "not content", "line": 728, "type": "if"}], "function_name": "TriggerRouter._update_module_brief"}], "TriggerRouter.on_file_save": [{"blocks": [{"condition": "not relevant", "line": 165, "type": "if"}, {"condition": "not self.config.should_process(estimated, hourly_spend=self.audit.hourly_spend()", "line": 174, "type": "if"}], "function_name": "TriggerRouter.on_file_save"}], "TriggerRouter.on_git_commit": [{"blocks": [{"condition": "not relevant", "line": 199, "type": "if"}, {"condition": "not self.config.should_process(estimated, hourly_spend=self.audit.hourly_spend()", "line": 209, "type": "if"}, {"condition": "self.audit.hourly_spend() + estimated > hourly_budget", "line": 225, "type": "if"}], "function_name": "TriggerRouter.on_git_commit"}], "TriggerRouter.on_manual_trigger": [{"blocks": [{"condition": "not relevant", "line": 615, "type": "if"}, {"condition": "not self.config.should_process(estimated, hourly_spend=self.audit.hourly_spend()", "line": 624, "type": "if"}], "function_name": "TriggerRouter.on_manual_trigger"}], "check_budget_with_message": [{"blocks": [{"condition": "remaining < estimated_cost", "line": 61, "type": "if"}], "function_name": "check_budget_with_message"}]}, "imports": ["__future__.annotations", "asyncio", "dataclasses.dataclass", "dataclasses.field", "json", "logging", "logging", "os", "os", "os", "pathlib.Path", "sys", "time", "typing.Any", "typing.Callable", "typing.Dict", "typing.List", "typing.Optional", "uuid", "vivarium.scout.audit.AuditLog", "vivarium.scout.big_brain.call_big_brain_async", "vivarium.scout.big_brain.call_big_brain_async", "vivarium.scout.big_brain.call_big_brain_async", "vivarium.scout.cli.index.query_for_nav", "vivarium.scout.config.HARD_MAX_HOURLY_BUDGET", "vivarium.scout.config.ScoutConfig", "vivarium.scout.config.get_global_semaphore", "vivarium.scout.deps.DependencyGraph", "vivarium.scout.git_analyzer.get_changed_files", "vivarium.scout.git_analyzer.get_diff_for_file", "vivarium.scout.git_analyzer.get_diff_for_file", "vivarium.scout.git_analyzer.get_diff_for_file", "vivarium.scout.git_drafts.assemble_commit_message", "vivarium.scout.ignore.IgnorePatterns", "vivarium.scout.llm.call_groq_async", "vivarium.scout.llm.call_groq_async", "vivarium.scout.llm.call_groq_async", "vivarium.scout.llm.call_groq_async", "vivarium.scout.validator.ValidationResult", "vivarium.scout.validator.Validator", "vivarium.scout.validator.validate_location"], "path": "/Users/vivariumenv1/Vivarium/vivarium/scout/router.py", "symbols": {"BRIEF_COST_PER_FILE": {"defined_at": 30, "docstring": null, "fields": [], "is_enum": false, "method_signatures": {}, "methods": [], "name": "BRIEF_COST_PER_FILE", "purpose_hint": null, "semantic_role": "configuration", "signature": null, "type": "constant", "type_annotation": null, "used_at": [723], "value": "0.005"}, "BudgetExhaustedError": {"defined_at": 36, "docstring": "Raised when hourly budget is exhausted before an LLM operation.", "fields": [], "is_enum": false, "method_signatures": {}, "methods": [], "name": "BudgetExhaustedError", "purpose_hint": null, "semantic_role": "implementation", "signature": null, "type": "class", "type_annotation": null, "used_at": [275], "value": null}, "COST_PER_MILLION_70B": {"defined_at": 29, "docstring": null, "fields": [], "is_enum": false, "method_signatures": {}, "methods": [], "name": "COST_PER_MILLION_70B", "purpose_hint": null, "semantic_role": "configuration", "signature": null, "type": "constant", "type_annotation": null, "used_at": [], "value": "0.9"}, "COST_PER_MILLION_8B": {"defined_at": 28, "docstring": null, "fields": [], "is_enum": false, "method_signatures": {}, "methods": [], "name": "COST_PER_MILLION_8B", "purpose_hint": null, "semantic_role": "configuration", "signature": null, "type": "constant", "type_annotation": null, "used_at": [157], "value": "0.2"}, "DRAFT_COST_PER_FILE": {"defined_at": 33, "docstring": null, "fields": [], "is_enum": false, "method_signatures": {}, "methods": [], "name": "DRAFT_COST_PER_FILE", "purpose_hint": null, "semantic_role": "configuration", "signature": null, "type": "constant", "type_annotation": null, "used_at": [270, 281], "value": "0.0004"}, "NavResult": {"defined_at": 77, "docstring": "Result of scout-nav LLM call.", "fields": [], "is_enum": false, "method_signatures": {}, "methods": [], "name": "NavResult", "purpose_hint": null, "semantic_role": "implementation", "signature": null, "type": "class", "type_annotation": null, "used_at": [656, 664, 672, 704, 734], "value": null}, "SymbolDoc": {"defined_at": 88, "docstring": "Generated symbol documentation.", "fields": [], "is_enum": false, "method_signatures": {}, "methods": [], "name": "SymbolDoc", "purpose_hint": null, "semantic_role": "implementation", "signature": null, "type": "class", "type_annotation": null, "used_at": [704, 707, 709], "value": null}, "TASK_NAV_ESTIMATED_COST": {"defined_at": 31, "docstring": "8B + retry + possible 70B escalation", "fields": [], "is_enum": false, "method_signatures": {}, "methods": [], "name": "TASK_NAV_ESTIMATED_COST", "purpose_hint": null, "semantic_role": "configuration", "signature": null, "type": "constant", "type_annotation": null, "used_at": [342], "value": "0.002"}, "TOKENS_PER_SMALL_FILE": {"defined_at": 27, "docstring": null, "fields": [], "is_enum": false, "method_signatures": {}, "methods": [], "name": "TOKENS_PER_SMALL_FILE", "purpose_hint": null, "semantic_role": "configuration", "signature": null, "type": "constant", "type_annotation": null, "used_at": [144, 149], "value": "500"}, "TriggerRouter": {"defined_at": 115, "docstring": "Orchestrates triggers, respects limits, prevents infinite loops,\n    and cascades doc updates safely.", "fields": [], "is_enum": false, "method_signatures": {"__init__": "def __init__(self, config: ScoutConfig=None, audit: AuditLog=None, validator: Validator=None, repo_root: Path=None, notify: Callable[[str], None]=None)", "_affects_module_boundary": "def _affects_module_boundary(self, file: Path, nav_result: NavResult) -> bool", "_create_human_ticket": "def _create_human_ticket(self, file: Path, nav_result: NavResult, validation: ValidationResult) -> None", "_create_pr_draft": "def _create_pr_draft(self, module: str, file: Path, session_id: str) -> None", "_critical_path_files": "def _critical_path_files(self) -> set", "_detect_module": "def _detect_module(self, file: Path) -> str", "_generate_commit_draft": "async def _generate_commit_draft(self, file: Path, session_id: str) -> None", "_generate_impact_summary": "async def _generate_impact_summary(self, file: Path, session_id: str) -> None", "_generate_pr_snippet": "async def _generate_pr_snippet(self, file: Path, session_id: str) -> None", "_generate_symbol_doc": "def _generate_symbol_doc(self, file: Path, nav_result: NavResult, validation: ValidationResult) -> SymbolDoc", "_is_public_api": "def _is_public_api(self, file: Path) -> bool", "_list_python_files": "def _list_python_files(self, entry: Optional[Path], limit: int=50) -> List[str]", "_load_symbol_docs": "def _load_symbol_docs(self, file: Path) -> str", "_parse_nav_json": "def _parse_nav_json(self, content: str) -> dict", "_process_file": "def _process_file(self, file: Path, session_id: str) -> None", "_quick_parse": "def _quick_parse(self, file: Path) -> str", "_quick_token_estimate": "def _quick_token_estimate(self, path: Path) -> int", "_scout_nav": "def _scout_nav(self, file: Path, context: str, model: str='8b') -> NavResult", "_update_module_brief": "def _update_module_brief(self, module: str, trigger_file: Path, session_id: str) -> float", "_write_draft": "def _write_draft(self, file: Path, symbol_doc: SymbolDoc) -> Path", "estimate_cascade_cost": "def estimate_cascade_cost(self, files: List[Path]) -> float", "estimate_task_nav_cost": "def estimate_task_nav_cost(self) -> float", "navigate_task": "async def navigate_task(self, task: str, entry: Optional[Path]=None, llm_client: Optional[Callable]=None) -> Optional[dict]", "on_file_save": "def on_file_save(self, path: Path) -> None", "on_git_commit": "def on_git_commit(self, changed_files: List[Path]) -> None", "on_manual_trigger": "def on_manual_trigger(self, files: List[Path], task: str=None) -> None", "prepare_commit_msg": "def prepare_commit_msg(self, message_file: Path) -> None", "should_trigger": "def should_trigger(self, files: List[Path]) -> List[Path]"}, "methods": ["__init__", "should_trigger", "_quick_token_estimate", "estimate_cascade_cost", "on_file_save", "on_git_commit", "prepare_commit_msg", "estimate_task_nav_cost", "_list_python_files", "_parse_nav_json", "navigate_task", "on_manual_trigger", "_quick_parse", "_scout_nav", "_affects_module_boundary", "_is_public_api", "_detect_module", "_critical_path_files", "_generate_symbol_doc", "_write_draft", "_update_module_brief", "_create_human_ticket", "_create_pr_draft", "_load_symbol_docs", "_generate_commit_draft", "_generate_pr_snippet", "_generate_impact_summary", "_process_file"], "name": "TriggerRouter", "purpose_hint": null, "semantic_role": "implementation", "signature": "def __init__(self, config: ScoutConfig=None, audit: AuditLog=None, validator: Validator=None, repo_root: Path=None, notify: Callable[[str], None]=None)", "type": "class", "type_annotation": null, "used_at": [], "value": null}, "_notify_user": {"defined_at": 95, "docstring": "Notify user (stub \u2014 override for testing or real UI).", "fields": [], "is_enum": false, "method_signatures": {}, "methods": [], "name": "_notify_user", "purpose_hint": null, "semantic_role": "implementation", "signature": "def _notify_user(message: str) -> None", "type": "function", "type_annotation": null, "used_at": [133], "value": null}, "check_budget_with_message": {"defined_at": 42, "docstring": "Check if operation can proceed within hourly budget.\n\n    Returns True if OK, False if blocked (and prints actionable error to stderr).", "fields": [], "is_enum": false, "method_signatures": {}, "methods": [], "name": "check_budget_with_message", "purpose_hint": null, "semantic_role": "implementation", "signature": "def check_budget_with_message(config: ScoutConfig, estimated_cost: float=0.01, audit: Optional[AuditLog]=None) -> bool", "type": "function", "type_annotation": null, "used_at": [272], "value": null}, "logger": {"defined_at": 24, "docstring": null, "fields": [], "is_enum": false, "method_signatures": {}, "methods": [], "name": "logger", "purpose_hint": "audit logging", "semantic_role": "configuration", "signature": null, "type": "constant", "type_annotation": null, "used_at": [322, 774, 785, 820, 846, 848], "value": "logging.getLogger(__name__)"}, "on_git_commit": {"defined_at": 103, "docstring": "Proactive echo: invalidate dependency graph for changed files.\n    Called by post-commit hook \u2014 runs in <100ms, no LLM cost.", "fields": [], "is_enum": false, "method_signatures": {}, "methods": [], "name": "on_git_commit", "purpose_hint": null, "semantic_role": "implementation", "signature": "def on_git_commit(changed_files: List[Path], repo_root: Optional[Path]=None) -> None", "type": "function", "type_annotation": null, "used_at": [], "value": null}}}